# Product Requirements Document: Auto Download Clicker

## 1. Introduction/Overview

텔레그램 데스크톱 애플리케이션에서 미디어 다운로드 버튼을 자동으로 감지하고 클릭하는 자동화 도구입니다. 사용자가 지정한 화면 영역 내에서 다운로드 버튼 이미지를 인식하고, 다운로드가 안된 항목들을 자동으로 클릭하여 일괄 다운로드를 수행합니다.

### Problem Statement
텔레그램에서 많은 양의 미디어를 다운로드할 때 각각의 다운로드 버튼을 수동으로 클릭해야 하는 번거로움이 있습니다. 이를 자동화하여 사용자의 시간과 노력을 절약합니다.

## 2. Goals

- 사용자가 지정한 화면 영역 내에서 다운로드 버튼을 자동으로 감지
- 다운로드되지 않은 미디어를 자동으로 클릭하여 다운로드 시작
- 다운로드 진행 상황을 모니터링하고 스크롤을 통해 연속적인 다운로드 수행
- 모든 항목이 다운로드 완료될 때까지 자동화 프로세스 유지

## 3. User Stories

1. **사용자는 다운로드할 영역을 지정하고 싶다**
   - As a 사용자, I want to 화면에서 사각형 영역을 지정 so that 특정 영역 내의 다운로드 버튼만 감지할 수 있다.

2. **사용자는 자동으로 다운로드를 시작하고 싶다**
   - As a 사용자, I want to 다운로드 안된 항목들을 자동으로 클릭 so that 수동 작업 없이 일괄 다운로드할 수 있다.

3. **사용자는 다운로드 진행 상황을 확인하고 싶다**
   - As a 사용자, I want to 다운로드 상태를 실시간으로 확인 so that 진행 상황을 파악할 수 있다.

4. **사용자는 자동 스크롤 기능을 원한다**
   - As a 사용자, I want to 다운로드 완료 시 자동으로 스크롤 so that 추가 항목들을 계속 다운로드할 수 있다.

## 4. Functional Requirements

### 4.1 영역 선택 기능
1. 시스템은 PySide6 기반의 투명한 오버레이 창을 제공해야 한다
2. 사용자는 마우스로 드래그하여 사각형 영역을 선택할 수 있어야 한다
3. 선택된 영역은 조절 가능한 테두리로 표시되어야 한다
4. 사용자는 선택된 영역의 크기와 위치를 조정할 수 있어야 한다

### 4.2 이미지 감지 기능
5. 시스템은 지정된 영역 내에서 3가지 상태 이미지를 감지해야 한다:
   - `not_download.jpg`: 다운로드 안됨 상태
   - `downloading.jpg`: 다운로드 중 상태
   - `downloaded.jpg`: 다운로드 완료 상태
6. 시스템은 각 상태별 이미지의 개수를 실시간으로 카운트해야 한다
7. 이미지 매칭은 OpenCV 또는 유사한 이미지 처리 라이브러리를 사용해야 한다

### 4.3 자동 클릭 기능
8. 시스템은 `not_download` 상태의 모든 이미지를 감지해야 한다
9. 감지된 `not_download` 이미지들을 자동으로 클릭해야 한다
10. 클릭 후 이미지가 `downloading` 상태로 변경되는지 확인해야 한다

### 4.4 스크롤 제어 기능
11. 시스템은 전체 감지된 이미지 중 `downloaded` 상태가 80% 이상일 때 아래로 스크롤해야 한다
12. 스크롤 후 새로운 영역에서 이미지 감지를 재시작해야 한다
13. `downloaded` 상태가 30% 미만일 때 스크롤을 정지해야 한다

### 4.5 종료 조건
14. 시스템은 다음 조건을 모두 만족할 때 작업을 종료해야 한다:
    - 더 이상 스크롤할 수 없음 (페이지 끝 도달)
    - 영역 내에 `not_download` 이미지가 없음
15. 작업 완료 시 사용자에게 완료 알림을 표시해야 한다

### 4.6 UI 컨트롤
16. 시작/정지 버튼을 제공해야 한다
17. 현재 상태 (감지된 이미지 수, 진행률 등)를 실시간으로 표시해야 한다
18. 스크롤 속도와 클릭 간격을 조절할 수 있는 설정을 제공해야 한다

## 5. Non-Goals (Out of Scope)

- 텔레그램 API 직접 연동
- 로그인/인증 처리
- 다운로드된 파일의 관리 (이동, 이름 변경 등)
- 이미지 외 다른 미디어 타입 처리
- 다운로드 속도 제어
- 네트워크 에러 처리
- 다운로드된 컨텐츠의 검증
- 다중 창 지원

## 6. Design Considerations

### UI/UX 요구사항
- 투명한 오버레이 창으로 대상 애플리케이션을 가리지 않음
- 반디캠과 유사한 영역 선택 인터페이스
- 최소한의 UI로 작업 중 방해 최소화
- 실시간 상태 표시를 위한 작은 컨트롤 패널

### 이미지 자원
- `/images/not_download.jpg`: 다운로드 안됨 버튼 템플릿
- `/images/downloading.jpg`: 다운로드 중 버튼 템플릿  
- `/images/downloaded.jpg`: 다운로드 완료 버튼 템플릿

## 7. Technical Considerations

### 기술 스택
- **언어**: Python 3.10+
- **GUI 프레임워크**: PySide6
- **이미지 처리**: OpenCV-Python
- **자동화**: PyAutoGUI 또는 pynput
- **패키지 관리**: uv (Astral)

### 주요 모듈 구조
- `src/core/screen_capture.py`: 화면 캡처 기능
- `src/core/image_detector.py`: 이미지 매칭 및 감지
- `src/core/automation.py`: 클릭 및 스크롤 자동화
- `src/ui/main_window.py`: 메인 UI 및 영역 선택

### 성능 고려사항
- 이미지 매칭 최적화 (템플릿 매칭 임계값 조정)
- 적절한 폴링 간격 설정 (CPU 사용률 vs 반응성)
- 메모리 효율적인 스크린샷 처리

## 8. Success Metrics

- **정확도**: 이미지 감지 정확도 95% 이상
- **성능**: 영역 내 10개 이미지 감지 시간 1초 이내
- **안정성**: 1시간 이상 연속 작동 시 크래시 없음
- **사용성**: 3클릭 이내로 자동화 시작 가능
- **완료율**: 감지된 모든 다운로드 대상의 95% 이상 성공적으로 클릭

## 9. Open Questions

1. 다운로드 실패 시 재시도 로직이 필요한가?
2. 이미지 매칭 신뢰도 임계값을 사용자가 조정할 수 있어야 하는가?
3. 작업 로그를 파일로 저장할 필요가 있는가?
4. 단축키 지원이 필요한가? (시작/정지 등)
5. 다크 모드/라이트 모드에 따른 이미지 템플릿 변경이 필요한가?
6. 스크롤 속도와 방향(위/아래)을 동적으로 조절해야 하는가?

---

*문서 작성일: 2025-09-08*  
*버전: 1.0*